rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
			allow write: if (request.auth == null && 
      	request.resource.data.user == "anonymous") || 
	      	(request.auth.uid == request.resource.data.user && 
  	    		exists(/databases/$(database)/documents/users/$(request.auth.uid)));
      allow update: if (request.auth == null && 
      	request.resource.data.user == "anonymous" &&
        	resource.data.user == "anonymous") || 
      			(request.auth.uid == request.resource.data.user &&
      				request.auth.uid == resource.data.user && 
      					exists(/databases/$(database)/documents/users/$(request.auth.uid)));
			allow read, delete: if (request.auth == null &&
        resource.data.user == "anonymous") ||
          (request.auth.uid == resource.data.user && 
            exists(/databases/$(database)/documents/users/$(request.auth.uid)));
    }
  }
}